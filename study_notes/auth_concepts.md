# 인증(Authentication) vs 인가(Authorization)

백엔드 개발의 영원한 숙제, 보안의 기초인 두 개념을 구분해 봅시다.

## 1. 인증 (Authentication) - "로그인"

**"Who are you?" (당신, 진짜 철수 맞아?)"**

- **정의**: 접속자가 누구인지 신원을 확인하는 절차입니다.
- **예시**:
  - 아이디/비밀번호 입력하기
  - 지문 인식
  - 휴대폰 본인 인증
- **우리의 구현**: 이메일과 비밀번호를 대조해서 맞으면 **"통행증(JWT)"**을 발급해 줄 겁니다.

---

## 2. 인가 (Authorization) - "권한 확인"

**"What can you do?" (철수야, 너 이거 할 수 있어?)"**

- **정의**: 인증된 사용자가 특정 자원에 접근할 권리가 있는지 확인하는 절차입니다.
- **예시**:
  - "관리자"만 공지사항을 쓸 수 있다.
  - "내 글"은 나만 수정할 수 있다.
  - 헬스장 회원권(인증)은 있어도, VIP존(인가)에는 못 들어간다.
- **우리의 구현**:
  - 댓글 삭제 요청이 오면 -> "이 댓글 쓴 사람(authorId)이랑 지금 로그인한 사람(userId)이랑 같아?" 확인

---

## 3. JWT (JSON Web Token) - 우리의 통행증

우리는 왜 **JWT**를 쓸까요? 그리고 그게 도대체 뭘까요?

### 🎫 JWT의 구조 (Anatomy)

JWT는 점(`.`)으로 구분된 세 부분으로 이루어진 긴 문자열입니다.
`aaaaaa.bbbbbb.cccccc` (Header.Payload.Signature)

#### 1. Header (헤더)

- "나 JWT야. 그리고 HS256 알고리즘으로 서명했어." (토큰의 타입과 암호화 방식 정보)

#### 2. Payload (내용) - **중요!**

- 실제 데이터를 담는 곳입니다. 여기에 담긴 정보는 **누구나** 열어볼 수 있습니다. (Base64 디코딩만 하면 보임)
- **절대 비밀번호 같은 중요 정보를 넣으면 안 됩니다!**
- 보통 `userId`, `email`, `만료시간(exp)` 정도만 넣습니다.

#### 3. Signature (서명) - **핵심 보안 장치**

- "이 토큰이 위조되지 않았다는 증거"입니다.
- **원리**: (Header + Payload) 내용을 서버만 아는 **비밀키(Secret Key)**로 잠급니다.
- 누군가 Payload를 조작(예: `userId: 1` -> `userId: 999`)하면, 서명 값이 달라져서 불일치 판정이 납니다.

---

### 🍪 세션 (Session) vs 🎫 토큰 (Token/JWT)

- **세션 (식당 장부)**:
  - 손님이 올 때마다 장부(서버 메모리/DB)에 "철수 옴"이라고 적어둡니다.
  - 장점이자 단점: 서버가 기억해야 합니다. (동접 100만 명이면 장부 터짐)
- **토큰 (놀이공원 자유이용권)**:
  - 손님 팔목에 **"2025-12-12까지 유효함"**이라고 적힌 띠(Token)를 둘러줍니다.
  - 서버는 아무것도 기억 안 합니다. 그냥 손님이 내미는 띠가 위조되지 않았는지만 검사합니다.
  - **Nest.js와 궁합이 아주 좋습니다.** (Stateless)

---

## 🚀 구현 순서

1.  **Auth 모듈 만들기**: 로그인 담당 부서 신설
2.  **User Service 수정**: 비밀번호 암호화 저장 (그냥 저장하면 범죄입니다!)
3.  **JWT 발급**: 로그인 성공하면 토큰 주기
4.  **Guard (경비원) 세우기**: 토큰 검사하는 로직 작성
